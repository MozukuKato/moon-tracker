<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Futuristic Moon Tracker</title>
<!-- Google Fonts for a sleek look -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
  /* Reset & Basic Styles */
  body {
    margin: 0;
    padding: 0;
    height: 100vh;
    font-family: 'Orbitron', sans-serif;
    background: radial-gradient(ellipse at center, #000011, #000022);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #0ff;
  }

  /* Canvas background: animated starfield with smooth movement */
  #starfield {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1;
  }

  /* The glowing Sun that condenses into black hole on click */
  #sun {
    position: absolute;
    top: 10%;
    left: 50%;
    width: 300px;
    height: 300px;
    margin-left: -150px;
    border-radius: 50%;
    background: radial-gradient(circle, #fff, #ffcc00);
    box-shadow: 0 0 100px #ffcc00, inset 0 0 50px #fff;
    cursor: pointer;
    transition: all 1s ease;
    z-index: 2;
  }
  #sun.condensed {
    width: 10px;
    height: 10px;
    margin-left: -5px;
    background: #000;
    box-shadow: none;
    animation: blackHole 1s forwards;
  }
  @keyframes blackHole {
    from { width: 300px; height: 300px; margin-left: -150px; }
    to { width: 10px; height: 10px; margin-left: -5px; }
  }

  /* Orbit ring and moon */
  #orbit-container {
    position: absolute;
    top: 10%;
    left: 50%;
    width: 900px;
    height: 900px;
    transform: translateX(-50%);
  }
  #orbit-path {
    position: absolute;
    top: 50%; left: 50%;
    width: 600px; height: 600px;
    margin: -300px 0 0 -300px;
    border-radius: 50%;
    border: 2px dashed rgba(0,255,255,0.3);
    box-shadow: inset 0 0 15px rgba(0,255,255,0.4);
  }
  /* Orbit rotation for smooth spinning */
  #moon-orbit {
    width: 100%; height: 100%;
    position: absolute;
    top: 0; left: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rotateOrbit 60s linear infinite;
    transform-origin: center;
  }
  @keyframes rotateOrbit {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Moon */
  #moon-wrapper {
    width: 300px; height: 300px;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    border-radius: 50%;
    box-shadow: 0 0 50px #0ff inset, 0 0 100px #0ff;
    transition: all 0.4s ease;
  }
  #moon-wrapper.glow {
    box-shadow: 0 0 150px #0ff inset, 0 0 300px #0ff;
    animation: pulseGlow 2s infinite;
  }
  @keyframes pulseGlow {
    0% { box-shadow: 0 0 50px #0ff inset, 0 0 100px #0ff; }
    50% { box-shadow: 0 0 150px #0ff inset, 0 0 300px #0ff; }
    100% { box-shadow: 0 0 50px #0ff inset, 0 0 100px #0ff; }
  }
  #moon-img {
    width: 300px; height: 300px;
    object-fit: cover;
    border-radius: 50%;
    transition: all 0.4s ease;
  }

  /* Glowing nebula for depth effect */
  .nebula-glow {
    position: absolute;
    top: -150px; left: -150px; right: -150px; bottom: -150px;
    margin: auto;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(0,255,255,0.2), transparent 70%);
    box-shadow: 0 0 400px #0ff, inset 0 0 200px #0ff;
    animation: nebulaPulse 8s ease-in-out infinite;
    z-index: -2;
  }
  @keyframes nebulaPulse {
    0% { box-shadow: 0 0 400px #0ff, inset 0 0 200px #0ff; }
    50% { box-shadow: 0 0 500px #0ff, inset 0 0 250px #0ff; }
    100% { box-shadow: 0 0 400px #0ff, inset 0 0 200px #0ff; }
  }

  /* Info cards container with hover effects */
  #info-cards {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 40px;
    width: 90%;
    max-width: 1400px;
  }
  .card {
    background: rgba(0,0,0,0.8);
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,255,255,0.4);
    padding: 25px;
    flex: 1 1 300px;
    min-width: 250px;
    transition: all 0.4s ease;
  }
  .card:hover {
    transform: translateY(-8px);
    box-shadow: 0 0 50px rgba(0,255,255,0.6);
  }
  .card h3 {
    margin-top: 0;
    color: #0ff;
    text-shadow: 0 0 10px #0ff;
  }

  /* Buttons style with glow effect */
button {
  background: #0ff;
  color: #000;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Orbitron', sans-serif;
  margin: 10px;
  box-shadow: 0 0 20px #0ff inset, 0 0 40px #0ff;
  font-size: 16px;
  transition: all 0.3s ease;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px #0ff inset, 0 0 60px #0ff;
}

/* Controls & toggles styling */
#controls {
  margin-top: 50px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 15px;
}
#controls button {
  padding: 10px 20px;
}
#toggles {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}
#toggles label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  cursor: pointer;
  color: #0ff;
}
#toggles input[type=checkbox] {
  transform: scale(1.2);
  accent-color: #0ff;
}

/* Modal for Moon Calendar */
#calendarModal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.95);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#calendarContent {
  background: #222;
  padding: 20px;
  border-radius: 15px;
  max-width: 90%;
  max-height: 80%;
  overflow: auto;
}
#closeCalendar {
  margin-top: 20px;
  padding: 10px 20px;
  background: #0ff;
  color: #000;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
#calendarGrid {
  display: grid;
  grid-template-columns: repeat(7, 50px);
  gap: 8px;
  justify-content: center;
}

/* Responsive adjustments */
@media(max-width: 768px){
  #orbit-container { width: 80%; height: auto; }
  #moon-wrapper { width: 200px; height: 200px; }
  #moon-img { width: 200px; height: 200px; }
}
</style>
</head>
<body>

<!-- Starfield Canvas -->
<canvas id="starfield"></canvas>

<!-- Sun that glows and condenses into black hole -->
<div id="sun"></div>

<!-- Orbit with Moon -->
<div id="orbit-container">
  <div id="orbit">
    <div id="orbit-path"></div>
    <div id="moon-orbit">
      <div id="moon-wrapper">
        <img id="moon-img" src="https://i.imgur.com/tGJGwu8.png" alt="Moon" />
      </div>
    </div>
  </div>
</div>

<!-- Main UI -->
<div style="margin-top:20px; width:90%; max-width:950px;">
  <div class="title">ðŸŒ™ Futuristic Moon Tracker</div>
  <div class="nebula-glow"></div>

  <!-- Moon info -->
  <div style="text-align:center; margin-top:20px;">
    <h2 id="phase-name"></h2>
    <p id="illumination"></p>
    <p id="moon-rise-set"></p>
  </div>

  <!-- Controls Buttons -->
  <div style="margin:20px; display:flex; gap:10px; justify-content:center;">
    <button id="prev">&#8592; Prev</button>
    <button id="next">Next &#8594;</button>
    <button id="calendarBtn">ðŸ“… Calendar</button>
  </div>

  <!-- Toggle orbital info -->
  <div id="toggles" style="margin-top:20px;">
    <label><input type="checkbox" id="showOrbital" checked/> Orbital Data</label>
  </div>

  <!-- Info Cards -->
  <div id="info-cards" style="margin-top:30px;">
    <div class="card" id="orbital-info" style="display:none;">
      <h3>Orbital Data</h3>
      <ul>
        <li>Eccentricity: 0.055</li>
        <li>Inclination: 5.14Â°</li>
        <li>Synodic Month: 29.53 days</li>
        <li>Distance: ~384,400 km</li>
      </ul>
    </div>
    <div class="card" id="cultural-info" style="display:none;">
      <h3>Cultural & Astronomical</h3>
      <p>The Moon influences tides, folklore, and cultures. Phases are key to many traditions.</p>
    </div>
  </div>
</div>

<!-- Moon Calendar Modal -->
<div id="calendarModal">
  <div id="calendarContent">
    <h3>Moon Phase Calendar</h3>
    <div id="calendarGrid"></div>
    <button id="closeCalendar">Close</button>
  </div>
</div>

<script>
// --- Variables & Data ---
const phases = [
  { name: "New Moon", img: "https://i.imgur.com/tGJGwu8.png", illum: "0%" },
  { name: "Waxing Crescent", img: "https://i.imgur.com/eZ3TYBb.png", illum: "25%" },
  { name: "First Quarter", img: "https://i.imgur.com/4wvUyUu.png", illum: "50%" },
  { name: "Waxing Gibbous", img: "https://i.imgur.com/tZMPofh.png", illum: "75%" },
  { name: "Full Moon", img: "https://i.imgur.com/9dOdfyQ.png", illum: "100%" },
  { name: "Waning Gibbous", img: "https://i.imgur.com/gJTYBe4.png", illum: "75%" },
  { name: "Last Quarter", img: "https://i.imgur.com/pCysGwt.png", illum: "50%" },
  { name: "Waning Crescent", img: "https://i.imgur.com/McKLzv5.png", illum: "25%" }
];
let currentPhaseIndex=0;
let currentOffsetDays=0;
let moonGlow=false;

// --- Animate starfield background ---
const starCanvas=document.getElementById('starfield');
const ctx=starCanvas.getContext('2d');
let stars=[];
function resizeStars() {
  starCanvas.width=window.innerWidth;
  starCanvas.height=window.innerHeight;
}
window.addEventListener('resize', resizeStars);
resizeStars();
for(let i=0;i<400;i++){
  stars.push({x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight,
    size:Math.random()*1.4, alpha:Math.random(),
    dx:(Math.random()-0.5)*0.2, dy:(Math.random()-0.5)*0.2});
}
function animateStars() {
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  ctx.globalAlpha=1;
  for(let s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,255,255,${s.alpha})`;
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0 || s.x>window.innerWidth) s.dx*=-1;
    if(s.y<0 || s.y>window.innerHeight) s.dy*=-1;
  }
  requestAnimationFrame(animateStars);
}
animateStars();

// --- Sun that glows and condenses into black hole ---
const sun=document.getElementById('sun');
sun.onclick=()=>{
  if(sun.classList.contains('condensed')){
    sun.classList.remove('condensed');
  } else {
    sun.classList.add('condensed');
  }
};

// --- Orbit with Moon ---
const moonWrapper=document.getElementById('moon-wrapper');
const moonImg=document.getElementById('moon-img');

moonWrapper.onclick=()=>{
  moonGlow=!moonGlow;
  if(moonGlow){
    moonWrapper.classList.add('glow');
  } else {
    moonWrapper.classList.remove('glow');
  }
};

// --- Animate orbit rotation ---
const orbitStyle=document.createElement('style');
orbitStyle.innerHTML=`@keyframes rotateOrbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`;
document.head.appendChild(orbitStyle);

// --- Animate moon glow ---
const glowStyle=document.createElement('style');
glowStyle.innerHTML=`
  @keyframes pulseGlow {
    0% { box-shadow: 0 0 50px #0ff inset, 0 0 100px #0ff; }
    50% { box-shadow: 0 0 150px #0ff inset, 0 0 300px #0ff; }
    100% { box-shadow: 0 0 50px #0ff inset, 0 0 100px #0ff; }
  }
  #moon-wrapper.glow { animation: pulseGlow 2s infinite; }
`;
document.head.appendChild(glowStyle);

// --- Moon phase display ---
const phaseNameEl=document.getElementById('phase-name');
const illumEl=document.getElementById('illumination');
const moonRiseSetEl=document.getElementById('moon-rise-set');

function getMoonAge(date){
  const known=new Date(Date.UTC(2000,0,6,18,14));
  const diff=(date - known)/(1000*60*60*24);
  return ((diff % 29.53)+29.53)%29.53;
}
function getMoonPhaseByAge(age){
  if(age<1.8457 || age>28.7) return phases[0];
  if(age<7.4) return phases[1];
  if(age<9.3) return phases[2];
  if(age<14.8) return phases[3];
  if(age<16.6) return phases[4];
  if(age<22) return phases[5];
  if(age<24) return phases[6];
  return phases[7];
}
function fetchMoonData(lat, lon, date){
  fetch(`https://api.open-meteo.com/v1/planet/moon?latitude=${lat}&longitude=${lon}&time=${getISODate(date)}`)
  .then(res=>res.json())
  .then(data=>{
    if(data && data.moon && data.moon.phase !== undefined){
      const phaseNumber=data.moon.phase; // 0-1
      if(phaseNumber<0.125) currentPhaseIndex=0;
      else if(phaseNumber<0.375) currentPhaseIndex=1;
      else if(phaseNumber<0.625) currentPhaseIndex=2;
      else if(phaseNumber<0.875) currentPhaseIndex=3;
      else currentPhaseIndex=4;
      updateMoonDisplay();
    }
  })
  .catch(()=>{
    const age=getMoonAge(date);
    currentPhaseIndex=getMoonPhaseByAge(age);
    updateMoonDisplay();
  });
}
function getISODate(d){return d.toISOString().slice(0,10);}
function updateMoonDisplay() {
  document.getElementById('moon-img').src=phases[currentPhaseIndex].img;
  phaseNameEl.innerText=phases[currentPhaseIndex].name;
  illumEl.innerText='Illumination: '+phases[currentPhaseIndex].illum;
}

// --- Main update ---
let currentOffsetDays=0;
let currentLatLon={lat:0, lon:0};
function update() {
  const date=new Date(Date.now()+currentOffsetDays*86400000);
  const age=getMoonAge(date);
  currentPhaseIndex=getMoonPhaseByAge(age);
  if(currentLatLon.lat!==0 || currentLatLon.lon!==0){
    fetchMoonData(currentLatLon.lat, currentLatLon.lon, date);
  } else {
    updateMoonDisplay();
  }
}
document.getElementById('prev').onclick=()=>{ currentOffsetDays--; update(); };
document.getElementById('next').onclick=()=>{ currentOffsetDays++; update(); };

// --- Toggle orbital info ---
document.getElementById('showOrbital').onchange=function(){ document.getElementById('orbital-info').style.display=this.checked?'block':'none'; };

// --- Calendar modal ---
const modal=document.getElementById('calendarModal');
document.getElementById('calendarBtn').onclick=()=>{ generateCalendar(); modal.style.display='flex'; }
document.getElementById('closeCalendar').onclick=()=>{ modal.style.display='none'; }

function generateCalendar() {
  const grid=document.getElementById('calendarGrid');
  grid.innerHTML='';
  const year=new Date().getFullYear();
  const firstDay=new Date(year,0,1).getDay();
  const totalDays=new Date(year+1,0,0).getDate();
  for(let i=0;i<firstDay;i++){
    const cell=document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px'; grid.appendChild(cell);
  }
  for(let d=1;d<=totalDays;d++){
    const date=new Date(year,0,d);
    const age=getMoonAge(date);
    let phaseIdx=0;
    if(age<1.8457 || age>28.7) phaseIdx=0;
    else if(age<7.4) phaseIdx=1;
    else if(age<9.3) phaseIdx=2;
    else if(age<14.8) phaseIdx=3;
    else if(age<16.6) phaseIdx=4;
    else if(age<22) phaseIdx=5;
    else if(age<24) phaseIdx=6;
    else phaseIdx=7;
    const cell=document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px'; cell.style.border='1px solid #555'; cell.style.borderRadius='8px'; cell.style.overflow='hidden'; cell.style.cursor='pointer';
    cell.title=`${date.toDateString()}\nPhase: ${phases[phaseIdx].name}`;
    cell.innerHTML=`<img src="${phases[phaseIdx].img}" style="width:46px;height:46px;">`;
    cell.onclick=()=>{
      currentOffsetDays=Math.round((date - new Date())/86400000);
      update();
      modal.style.display='none';
    }
    grid.appendChild(cell);
  }
}

// --- Animate starfield background ---
function animateStars() {
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  ctx.globalAlpha=1;
  for(let s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,255,255,${s.alpha})`;
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0 || s.x>window.innerWidth) s.dx*=-1;
    if(s.y<0 || s.y>window.innerHeight) s.dy*=-1;
  }
  requestAnimationFrame(animateStars);
}
animateStars();

// --- Event Listeners ---
document.getElementById('sun').onclick=()=>{
  document.getElementById('sun').classList.toggle('condensed');
};
document.getElementById('moon-wrapper').onclick=()=>{
  moonGlow=!moonGlow;
  if(moonGlow){
    document.getElementById('moon-wrapper').classList.add('glow');
  } else {
    document.getElementById('moon-wrapper').classList.remove('glow');
  }
};

// Initialize
update();

</script>
<script type="module" src="js/app.js"></script>

</body>
</html>
