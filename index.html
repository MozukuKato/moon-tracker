<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Futuristic Moon Tracker</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<style>
body {
  margin: 0; padding: 0; overflow: hidden;
  font-family: 'Orbitron', sans-serif;
  background: radial-gradient(ellipse at center, #000011, #000022);
  color: #0ff;
  display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
  height: 100vh;
}

/* Canvas for starfield background */
#starfield {
  position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1;
  background: radial-gradient(ellipse at center, #000011, #000022);
}

/* Top info panel with Moon phase and buttons */
#topPanel {
  margin-top: 20px; width: 100%; display: flex; flex-direction: column; align-items: center;
}
#moonImage {
  width: 200px; height: 200px; border-radius:50%; object-fit:cover; box-shadow:0 0 20px #0ff inset;
}
#phaseTitle {
  font-size: 1.5em; margin-top: 10px; text-shadow:0 0 10px #0ff;
}
#buttons {
  margin-top: 15px; display:flex; gap:15px;
}
button {
  background:#0ff; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:700; font-family:'Orbitron'; font-size:1em;
  box-shadow:0 0 10px #0ff inset; transition: all 0.2s;
}
button:hover { transform:scale(1.05); box-shadow:0 0 20px #0ff inset; }

/* Space background nebula effect */
#nebula {
  position: absolute; top:-200px; left:-200px; right:-200px; bottom:-200px; margin:auto; border-radius:50%;
  background: radial-gradient(circle, rgba(0,255,255,0.2), transparent 70%);
  box-shadow: 0 0 600px #0ff, inset 0 0 300px #0ff;
  animation: nebulaPulse 12s ease-in-out infinite;
  z-index:-2;
}
@keyframes nebulaPulse {
  0% { box-shadow: 0 0 600px #0ff, inset 0 0 300px #0ff; }
  50% { box-shadow: 0 0 700px #0ff, inset 0 0 350px #0ff; }
  100% { box-shadow: 0 0 600px #0ff, inset 0 0 300px #0ff; }
}

/* Orbit circle with moon */
#orbitContainer {
  position: absolute; top:20%; left:50%; transform:translateX(-50%);
  width: 600px; height: 600px;
}
#orbitPath {
  position: absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width: 400px; height: 400px; border-radius:50%; border:2px dashed rgba(0,255,255,0.4);
}
#moonOrbit {
  width:100%; height:100%; position:absolute; top:0; left:0;
  display:flex; justify-content:center; align-items:center;
  animation: rotateOrbit 60s linear infinite;
  transform-origin: center;
}
@keyframes rotateOrbit {
  from {transform: rotate(0deg);}
  to {transform: rotate(360deg);}
}
#moonWrapper {
  width: 150px; height: 150px; border-radius:50%; cursor:pointer;
  box-shadow:0 0 20px #0ff inset;
  transition: all 0.3s;
}
#moonWrapper.glow {
  box-shadow:0 0 80px #0ff inset, 0 0 160px #0ff;
  animation: pulseGlow 2s infinite;
}
@keyframes pulseGlow {
  0% { box-shadow:0 0 20px #0ff inset; }
  50% { box-shadow:0 0 80px #0ff inset, 0 0 160px #0ff; }
  100% { box-shadow:0 0 20px #0ff inset; }
}
#moonImg {
  width: 150px; height:150px; object-fit:cover; border-radius:50%;
}

/* Moon info display */
#moonInfo {
  margin-top:20px; text-align:center; font-size:1.2em; text-shadow:0 0 10px #0ff;
}
#moonInfo h2 { margin:10px 0; }
#moonInfo p { margin:5px 0; }
</style>
</head>
<body>

<div id="starfield"></div>
<div id="nebula"></div>

<!-- Top info and buttons -->
<div id="topPanel">
  <img id="moonImage" src="https://i.imgur.com/tGJGwu8.png" />
  <div id="phaseTitle">Loading...</div>
  <div id="moonInfo">
    <h2 id="phaseName">Loading...</h2>
    <p id="illumination"></p>
    <p id="riseSet"></p>
  </div>
  <div id="buttons">
    <button id="prevBtn">‚Üê Prev</button>
    <button id="nextBtn">Next ‚Üí</button>
    <button id="calendarBtn">üìÖ Calendar</button>
  </div>
</div>

<!-- Orbit with moon -->
<div id="orbitContainer">
  <div id="orbit">
    <div id="orbitPath"></div>
    <div id="moonOrbit">
      <div id="moonWrapper">
        <img id="moonImg" src="https://i.imgur.com/tGJGwu8.png" />
      </div>
    </div>
  </div>
</div>

<!-- Calendar Modal -->
<div id="calendarModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); align-items:center; justify-content:center; z-index:9999;">
  <div style="background:#222; padding:20px; border-radius:15px; max-width:90%; max-height:80%; overflow:auto;">
    <h3 style="color:#0ff;">Moon Phase Calendar</h3>
    <div id="calendarGrid" style="display:grid; grid-template-columns:repeat(7,50px); gap:8px; justify-content:center;"></div>
    <button id="closeCalendar" style="margin-top:20px; padding:10px 20px; background:#0ff; border:none; border-radius:8px;">Close</button>
  </div>
</div>

<script>
// ============================
// Data & Variables
// ============================
const phases = [
  { name: "New Moon", img: "https://i.imgur.com/tGJGwu8.png", illum: "0%" },
  { name: "Waxing Crescent", img: "https://i.imgur.com/eZ3TYBb.png", illum: "25%" },
  { name: "First Quarter", img: "https://i.imgur.com/4wvUyUu.png", illum: "50%" },
  { name: "Waxing Gibbous", img: "https://i.imgur.com/tZMPofh.png", illum: "75%" },
  { name: "Full Moon", img: "https://i.imgur.com/9dOdfyQ.png", illum: "100%" },
  { name: "Waning Gibbous", img: "https://i.imgur.com/gJTYBe4.png", illum: "75%" },
  { name: "Last Quarter", img: "https://i.imgur.com/pCysGwt.png", illum: "50%" },
  { name: "Waning Crescent", img: "https://i.imgur.com/McKLzv5.png", illum: "25%" }
];

let currentPhaseIndex = 0;
let offsetDays = 0;
let moonGlow = false;

// ============================
// Animate Starfield
// ============================
const starCanvas = document.createElement('canvas');
starCanvas.id='starCanvas'; document.body.appendChild(starCanvas);
const ctx = starCanvas.getContext('2d');
let stars=[];

function resizeStars() {
  starCanvas.width=window.innerWidth;
  starCanvas.height=window.innerHeight;
}
window.addEventListener('resize', resizeStars);
resizeStars();

for(let i=0; i<700; i++){
  stars.push({
    x:Math.random()*window.innerWidth,
    y:Math.random()*window.innerHeight,
    size:Math.random()*1.5,
    alpha:Math.random(),
    dx:(Math.random()-0.5)*0.2,
    dy:(Math.random()-0.5)*0.2
  });
}

function animateStars() {
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  ctx.globalAlpha=1;
  for(let s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,255,255,${s.alpha})`;
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0||s.x>window.innerWidth) s.dx*=-1;
    if(s.y<0||s.y>window.innerHeight) s.dy*=-1;
  }
  requestAnimationFrame(animateStars);
}
animateStars();

// ============================
// Sun toggle to black hole
// ============================
const sun = document.getElementById('sun');
sun.onclick=()=> {
  if(sun.classList.contains('condensed')){
    sun.classList.remove('condensed');
  } else {
    sun.classList.add('condensed');
  }
};

// ============================
// Orbit & Moon setup
// ============================
const moonWrapper = document.getElementById('moonWrapper');
const moonImg = document.getElementById('moonImg');

moonWrapper.onclick=()=>{
  moonGlow=!moonGlow;
  if(moonGlow){
    moonWrapper.classList.add('glow');
  } else {
    moonWrapper.classList.remove('glow');
  }
};

// Animate orbit
const orbitCSS=document.createElement('style');
orbitCSS.innerHTML='@keyframes rotateOrbit { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }';
document.head.appendChild(orbitCSS);
const glowCSS=document.createElement('style');
glowCSS.innerHTML='@keyframes pulseGlow {0% {box-shadow:0 0 20px #0ff inset;}50% {box-shadow:0 0 80px #0ff inset;}100% {box-shadow:0 0 20px #0ff inset;}}#moonWrapper.glow {animation:pulseGlow 2s infinite;}';
document.head.appendChild(glowCSS);

// ============================
// Moon info display
// ============================
const phaseName = document.getElementById('phaseName');
const illumination = document.getElementById('illumination');
const riseSet = document.getElementById('riseSet');

function getMoonAge(date){
  const known=new Date(Date.UTC(2000,0,6,18,14));
  const diff=(date-known)/(1000*60*60*24);
  return ((diff%29.53)+29.53)%29.53;
}
function getMoonPhase(age){
  if(age<1.8457 || age>28.7) return phases[0];
  if(age<7.4) return phases[1];
  if(age<9.3) return phases[2];
  if(age<14.8) return phases[3];
  if(age<16.6) return phases[4];
  if(age<22) return phases[5];
  if(age<24) return phases[6];
  return phases[7];
}

function updateMoon(date){
  const age=getMoonAge(date);
  const phase=getMoonPhase(age);
  document.getElementById('moonImg').src=phase.img;
  phaseName.innerText=phase.name;
  illumination.innerText='Illumination: '+phase.illum;
}

// ============================
// Main update
// ============================
function update() {
  const date=new Date(Date.now()+offsetDays*86400000);
  updateMoon(date);
}

document.getElementById('prevBtn').onclick=()=>{ offsetDays--; update(); };
document.getElementById('nextBtn').onclick=()=>{ offsetDays++; update(); };

// Calendar popup
const calModal=document.getElementById('calendarModal');
document.getElementById('calendarBtn').onclick=()=>{
  generateCalendar();
  calModal.style.display='flex';
};
document.getElementById('closeCalendar').onclick=()=>{
  calModal.style.display='none';
};
function generateCalendar(){
  const grid=document.getElementById('calendarGrid');
  grid.innerHTML='';
  const year=new Date().getFullYear();
  const firstDay=new Date(year,0,1).getDay();
  const totalDays=new Date(year+1,0,0).getDate();

  for(let i=0;i<firstDay;i++){
    const cell=document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px';
    grid.appendChild(cell);
  }
  for(let d=1;d<=totalDays;d++){
    const date=new Date(year,0,d);
    const age=getMoonAge(date);
    let phaseIdx=0;
    if(age<1.8457 || age>28.7) phaseIdx=0;
    if(age<7.4) phaseIdx=1;
    else if(age<9.3) phaseIdx=2;
    else if(age<14.8) phaseIdx=3;
    else if(age<16.6) phaseIdx=4;
    else if(age<22) phaseIdx=5;
    else if(age<24) phaseIdx=6;
    else phaseIdx=7;
    const cell=document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px'; cell.style.border='1px solid #555'; cell.style.borderRadius='8px'; cell.style.overflow='hidden'; cell.style.cursor='pointer';
    cell.title=`${date.toDateString()}\nPhase: ${phases[phaseIdx].name}`;
    cell.innerHTML=`<img src="${phases[phaseIdx].img}" style="width:46px;height:46px;">`;
    cell.onclick=()=>{
      offsetDays=Math.round((date - new Date())/86400000);
      update();
      calModal.style.display='none';
    };
    grid.appendChild(cell);
  }
}

// ============================
// Animate stars
// ============================
function animateStars() {
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  ctx.globalAlpha=1;
  for(let s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,255,255,${s.alpha})`;
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0||s.x>window.innerWidth) s.dx*=-1;
    if(s.y<0||s.y>window.innerHeight) s.dy*=-1;
  }
  requestAnimationFrame(animateStars);
}
animateStars();

// ============================
// Initialization
// ============================
let offsetDays=0; update();
</script>
