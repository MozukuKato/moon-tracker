<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Moon Tracker - Restart</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<style>
  /* ... [your CSS, unchanged except for starfield canvas] ... */
  #starfield {
    position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1;
    display: block;
  }
  /* ... [rest of your CSS, unchanged] ... */
</style>
</head>
<body>

<!-- Space background -->
<canvas id="starfield"></canvas>
<div id="nebula"></div>

<!-- Top Section: Moon image, info, buttons -->
<div id="topSection">
  <img id="moonImage" src="https://i.imgur.com/tGJGwu8.png" />
  <div id="phaseTitle">Loading...</div>
  <div id="moonInfo">
    <h2 id="phaseName">Loading...</h2>
    <p id="illumination"></p>
    <p id="riseSet"></p>
  </div>
  <div id="buttons">
    <button id="prevBtn">‚Üê Prev</button>
    <button id="nextBtn">Next ‚Üí</button>
    <button id="calendarBtn">üìÖ Calendar</button>
  </div>
</div>

<!-- Orbit with Moon [unchanged] -->
<div id="orbitContainer">
  <div id="orbit">
    <div id="orbitPath"></div>
    <div id="moonOrbit">
      <div id="moonWrapper">
        <img id="moonImg" src="https://i.imgur.com/tGJGwu8.png" />
      </div>
    </div>
  </div>
</div>

<!-- Calendar Modal [unchanged] -->
<div id="calendarModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); align-items:center; justify-content:center; z-index:9999;">
  <div style="background:#222; padding:20px; border-radius:15px; max-width:90%; max-height:80%; overflow:auto;">
    <h3 style="color:#0ff;">Moon Phase Calendar</h3>
    <div id="calendarGrid" style="display:grid; grid-template-columns:repeat(7,50px); gap:8px; justify-content:center;"></div>
    <button id="closeCalendar" style="margin-top:20px; padding:10px 20px; background:#0ff; border:none; border-radius:8px;">Close</button>
  </div>
</div>

<script>
// ============================
// Data & Variables
// ============================
const phases = [
  { name: "New Moon", img: "https://i.imgur.com/tGJGwu8.png", illum: "0%" },
  { name: "Waxing Crescent", img: "https://i.imgur.com/eZ3TYBb.png", illum: "25%" },
  { name: "First Quarter", img: "https://i.imgur.com/4wvUyUu.png", illum: "50%" },
  { name: "Waxing Gibbous", img: "https://i.imgur.com/tZMPofh.png", illum: "75%" },
  { name: "Full Moon", img: "https://i.imgur.com/9dOdfyQ.png", illum: "100%" },
  { name: "Waning Gibbous", img: "https://i.imgur.com/gJTYBe4.png", illum: "75%" },
  { name: "Last Quarter", img: "https://i.imgur.com/pCysGwt.png", illum: "50%" },
  { name: "Waning Crescent", img: "https://i.imgur.com/McKLzv5.png", illum: "25%" }
];

let offsetDays = 0;
let moonGlow = false;

// ============================
// Animate starfield background
// ============================
const starCanvas = document.getElementById('starfield');
const ctx = starCanvas.getContext('2d');

function resizeStars() {
  starCanvas.width = window.innerWidth;
  starCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeStars);
resizeStars();

const stars = [];
for(let i=0; i<700; i++){
  stars.push({
    x:Math.random()*window.innerWidth,
    y:Math.random()*window.innerHeight,
    size:Math.random()*1.5,
    alpha:Math.random(),
    dx:(Math.random()-0.5)*0.2,
    dy:(Math.random()-0.5)*0.2
  });
}

function animateStars() {
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  ctx.globalAlpha=1;
  for(let s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(0,255,255,${s.alpha})`;
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0||s.x>window.innerWidth) s.dx*=-1;
    if(s.y<0||s.y>window.innerHeight) s.dy*=-1;
  }
  requestAnimationFrame(animateStars);
}
animateStars();

// ============================
// Orbit & Moon setup
// ============================
const moonWrapper = document.getElementById('moonWrapper');
const moonImg = document.getElementById('moonImg');

moonWrapper.onclick=()=>{
  moonGlow = !moonGlow;
  if(moonGlow){
    moonWrapper.classList.add('glow');
  } else {
    moonWrapper.classList.remove('glow');
  }
};

// ============================
// Moon info display
// ============================
const phaseTitle = document.getElementById('phaseTitle');
const phaseName = document.getElementById('phaseName');
const illumination = document.getElementById('illumination');
const riseSet = document.getElementById('riseSet');

function getMoonAge(date){
  const known = new Date(Date.UTC(2000,0,6,18,14));
  const diff = (date - known) / (1000*60*60*24);
  return ((diff % 29.530588853) + 29.530588853) % 29.530588853;
}
function getMoonPhase(age){
  if(age<1.8457 || age>28.7) return phases[0];
  if(age<7.4) return phases[1];
  if(age<9.3) return phases[2];
  if(age<14.8) return phases[3];
  if(age<16.6) return phases[4];
  if(age<22) return phases[5];
  if(age<24) return phases[6];
  return phases[7];
}

// Optionally: Calculate rise/set times (simple placeholder example)
function getRiseSet(date) {
  // Real astronomical calculation is complex. Here's a placeholder:
  return "Rise: ~6:00 PM / Set: ~6:00 AM";
}

function updateMoon(date){
  const age = getMoonAge(date);
  const phase = getMoonPhase(age);
  moonImg.src = phase.img;
  document.getElementById('moonImage').src = phase.img;
  phaseTitle.innerText = phase.name + ' (' + date.toDateString() + ')';
  phaseName.innerText = phase.name;
  illumination.innerText = 'Illumination: ' + phase.illum;
  riseSet.innerText = getRiseSet(date);
}

// ============================
// Main update
// ============================
function update() {
  const date = new Date(Date.now() + offsetDays * 86400000);
  updateMoon(date);
}

document.getElementById('prevBtn').onclick = () => { offsetDays--; update(); };
document.getElementById('nextBtn').onclick = () => { offsetDays++; update(); };

// Calendar modal
const calModal = document.getElementById('calendarModal');
document.getElementById('calendarBtn').onclick = () => {
  generateCalendar();
  calModal.style.display = 'flex';
};
document.getElementById('closeCalendar').onclick = () => {
  calModal.style.display = 'none';
};

function generateCalendar() {
  const grid = document.getElementById('calendarGrid');
  grid.innerHTML = '';
  const year = new Date().getFullYear();
  const firstDay = new Date(year,0,1).getDay();
  const totalDays = new Date(year+1,0,0).getDate();

  for(let i=0;i<firstDay;i++){
    const cell = document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px';
    grid.appendChild(cell);
  }
  for(let d=1;d<=totalDays;d++){
    const date = new Date(year,0,d);
    const age = getMoonAge(date);
    const phase = getMoonPhase(age);
    const cell = document.createElement('div');
    cell.style.width='50px'; cell.style.height='50px'; cell.style.border='1px solid #555'; cell.style.borderRadius='8px'; cell.style.overflow='hidden'; cell.style.cursor='pointer';
    cell.title = `${date.toDateString()}\nPhase: ${phase.name}`;
    cell.innerHTML = `<img src="${phase.img}" style="width:46px;height:46px;">`;
    cell.onclick = () => {
      offsetDays = Math.round((date - new Date()) / 86400000);
      update();
      calModal.style.display = 'none';
    };
    grid.appendChild(cell);
  }
}

// Initialize
update();

</script>
</body>
</html>
